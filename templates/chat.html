{% extends "base.html" %}
{% set active_page = "chat" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/chat.css') }}">
{% endblock %}

{% block content %}
<div class="chat-wrapper">
    <!-- History Sidebar -->
    <aside class="history-sidebar" id="history-sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title">Chat History</span>
            <button class="sidebar-close" id="sidebar-close" title="Close">&times;</button>
        </div>
        <button class="sidebar-new-chat" id="new-chat-btn">+ New Chat</button>
        <div class="sidebar-sessions" id="sidebar-sessions">
            <div class="sidebar-loading">Loading...</div>
        </div>
    </aside>

    <!-- Main Chat Area -->
    <div class="chat-container">
        <div class="chat-toolbar">
            <button class="toolbar-btn" id="history-toggle" title="Chat History">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8v4l3 3"/>
                    <circle cx="12" cy="12" r="10"/>
                </svg>
                <span>History</span>
            </button>
            <div class="beacon-selector">
                <select id="beacon-select" class="beacon-dropdown">
                    <option value="">Select a beacon...</option>
                </select>
                <button class="btn btn-primary btn-sm" id="open-beacon-chat">Open Chat</button>
                <button class="btn btn-sm" id="open-general-chat">No Specific Beacon</button>
            </div>
            <span class="chat-session-label" id="chat-session-label"></span>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="empty-state" id="chat-empty">
                <div class="empty-state-icon">&gt;_</div>
                <div class="empty-state-text">Awaiting operator commands...</div>
            </div>
        </div>
        <div class="chat-input-area">
            <div class="typing-indicator" id="typing-indicator" style="display:none;">
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-label">Processing...</span>
                <button class="cancel-btn" id="cancel-btn" title="Cancel operation">Cancel</button>
            </div>
            <form id="chat-form" class="chat-form" autocomplete="off">
                <span class="prompt-symbol">&gt;</span>
                <input type="text" id="chat-input" class="chat-input" placeholder="Enter command..." autofocus>
                <button type="submit" class="btn btn-primary chat-send">Execute</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', path='js/chat.js') }}"></script>
{% endblock %}
